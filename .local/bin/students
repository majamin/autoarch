#!/bin/sh

read -p "Please select a term (an integer 1-4):" TERM

if [[ "$TERM" =~ ^[1-4]+$ ]]; then
	fetch() {
		ls -t $(find $HOME/OneDrive/_data/ed/myed/allstudents/QR* -type f) | \
		head -n 1 | \
		xargs cat | \
		awk -F, '{print $1 ", " $2}' | \
		sed "s/\"//g" | \
		fzf | \
		xargs -I {} grep {} -hrnw $(find "${HOME}"/OneDrive/_data/ed/myed/allstaff/*/*/4 -name "*tsv") | \
		sed "s/^[0-9]\+://g"
	}
	
	list=("Current Teachers\nCurrent Classes\nID\nSchool Email\nPrimary Contact Email\nPrimary Contact Phone\nAll")
	
	choice=$(echo -e $list | fzf)
	
	case $choice in
		"Current Teachers" 	) fetch | awk -F $'\t' '{print $1}' | uniq ;;
		"Current Classes" 	) fetch | awk -F $'\t' '{print $9}' | uniq ;;
		"ID" 			) fetch | awk -F $'\t' '{print $3}' | uniq ;;
		"School Email"		) fetch | awk -F $'\t' '{print $4}' | uniq ;;
		"Primary Contact Email" ) fetch | awk -F $'\t' '{print $5 " (" $6 ") " $7}' | uniq ;;
		"Primary Contact Phone" ) fetch | awk -F $'\t' '{print $5 " (" $6 ") " $8}' | uniq ;;
		"All"			) fetch
	esac
else echo "No valid term chosen. Exiting." >&2 && exit 1; fi
