#!/bin/sh

# While tweaking all of my dotfiles, it's convenient to have an indicator
# script that lets me know if things have been changed, but not pushed to
# github. That's what this script does. If ANY files have been changed in
# $HOME or ~/.local/src repos, but not pushed, we'll see a warning in the
# statusbar.

LOG="$HOME/bargit.log"
rm $LOG 2>/dev/null
FLAG=false

ls_files(){
	echo "$(git -C "$1" ls-files --modified)"
}

DIRS="$HOME $(find "$HOME/.local/src" -maxdepth 1 -type d)"

# check src repos
for DIR in $DIRS; do
	FILES=$(ls_files $DIR)
	if [[ -z $FILES ]]; then
		break
	else
		FLAG=true
		echo "$FILES" > $LOG
	fi
done

[[ $FLAG ]] && echo -e "\x09(GIT)\x01"
